networks:
  koordenet:
    driver: bridge

volumes:
  koorde-results:

services:
    # Bootstrap node
  koorde-bootstrap:
    image: flaviosimonelli/koorde-node:latest
    container_name: koorde-bootstrap
    restart: always
    environment:
      - BOOTSTRAP_PEERS=
    env_file:
      - ./common_node.env
    networks:
      - koordenet

  # Tester client
  koorde-client:
    image: flaviosimonelli/koorde-tester:latest
    container_name: koorde-tester
    restart: no
    depends_on:
      - koorde-bootstrap
    environment:
      - SIM_DURATION=${SIM_DURATION}
      - QUERY_RATE=${QUERY_RATE}
      - QUERY_PARALLELISM_MIN=${QUERY_PARALLELISM_MIN}
      - QUERY_PARALLELISM_MAX=${QUERY_PARALLELISM_MAX}
    env_file:
      - ./tester.env
    volumes:
      - koorde-results:/data/results
    networks:
      - koordenet

  # non rimuovere il successivo commento, serve per generare automaticamente i peer
  # Template for peers
  peer-template:
    image: flaviosimonelli/koorde-node:latest
    container_name: koorde-peer-$ID
    restart: unless-stopped
    depends_on:
      - koorde-bootstrap
    environment:
      - BOOTSTRAP_PEERS=koorde-bootstrap:4000
    env_file:
      - ./common_node.env
    networks:
      - koordenet